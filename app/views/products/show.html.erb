<div class="container mx-auto px-4">
  <div class="flex flex-col md:flex-row gap-8">
    <!-- Product Image -->
<!-- Product Image -->
<!-- In your HTML (products/show.html.erb) -->
    <div class="md:w-1/2">
      <div class="product-image__container">
        <img
          id="main-product-image"
          src="<%= @product.product_variants.first.image_url %>"
          alt="<%= @product.name %>"
          class="product-image__main"
        >
      </div>
    </div>

    <!-- Product Info -->
    <div class="md:w-1/2">
      <h1 class="text-3xl font-bold mb-4"><%= @product.name %></h1>
      <p class="text-gray-600 mb-4"><%= @product.description %></p>
      <p class="text-2xl font-bold mb-6">Starting at <%= number_to_currency(@product.base_price) %></p>

      <!-- Color Selection -->
      <div class="mb-6">
        <h2 class="text-lg font-semibold mb-2">Select Color</h2>
        <div class="flex gap-2">
          <% @colors.each do |color| %>
            <button
              data-color-id="<%= color.id %>"
              data-image-url="<%= @product.product_variants.find_by(color: color)&.image_url %>"
              class="color-select p-2 border rounded-lg hover:border-blue-500">
              <%= color.name %>
            </button>
          <% end %>
        </div>
      </div>

      <!-- Size Selection -->
      <div class="mb-6">
        <h2 class="text-lg font-semibold mb-2">Select Size</h2>
        <div class="flex gap-2">
          <% @sizes.each do |size| %>
            <button
              data-size-id="<%= size.id %>"
              class="size-select p-2 border rounded-lg hover:border-blue-500">
              <%= size.name %>
            </button>
          <% end %>
        </div>
      </div>

      <!-- Add to Cart Button -->
      <%= form_tag new_order_path, method: :get, class: "mt-6" do %>
        <%= hidden_field_tag :variant_id, "", id: "selected_variant_id" %>
        <%= button_tag "Add to Cart",
            class: "w-full bg-blue-600 text-white py-3 px-6 rounded-lg disabled:bg-gray-400 hover:bg-blue-700",
            disabled: true,
            id: "add_to_cart_button" %>
      <% end %>
    </div>
  </div>
</div>

<%# JavaScript for handling variant selection and image updates %>
<script>
document.addEventListener('DOMContentLoaded', function() {
  let selectedColor = null;
  let selectedSize = null;
  const addToCartButton = document.getElementById('add_to_cart_button');
  const variantIdField = document.getElementById('selected_variant_id');
  const mainImage = document.getElementById('main-product-image');

  // Color selection
  document.querySelectorAll('.color-select').forEach(button => {
    button.addEventListener('click', function() {
      // Update selected color
      selectedColor = this.dataset.colorId;

      // Update image
      const imageUrl = this.dataset.imageUrl;
      if (imageUrl) {
        mainImage.src = imageUrl;
      }

      // Update visual selection
      document.querySelectorAll('.color-select').forEach(btn => {
        btn.classList.remove('border-blue-500', 'border-2');
      });
      this.classList.add('border-blue-500', 'border-2');

      checkVariantAvailability();
    });
  });

  // Size selection
  document.querySelectorAll('.size-select').forEach(button => {
    button.addEventListener('click', function() {
      // Update selected size
      selectedSize = this.dataset.sizeId;

      // Update visual selection
      document.querySelectorAll('.size-select').forEach(btn => {
        btn.classList.remove('border-blue-500', 'border-2');
      });
      this.classList.add('border-blue-500', 'border-2');

      checkVariantAvailability();
    });
  });

  function checkVariantAvailability() {
    if (selectedColor && selectedSize) {
      fetch(`/product_variants?product_id=<%= @product.id %>&color_id=${selectedColor}&size_id=${selectedSize}`)
        .then(response => response.json())
        .then(data => {
          if (data.available) {
            addToCartButton.disabled = false;
            variantIdField.value = data.id;
            addToCartButton.classList.remove('bg-gray-400');
            addToCartButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
          } else {
            addToCartButton.disabled = true;
            variantIdField.value = "";
            addToCartButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            addToCartButton.classList.add('bg-gray-400');
          }
        });
    }
  }
});
</script>
